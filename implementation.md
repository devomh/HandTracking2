## Project Structure Proposal

```
hand_tracked_musical_interface/
├── config/
│   └── config.yaml
├── docs/
│   └── specification.md
├── resources/
│   └── (optional: samples/, fonts/)
├── src/
│   ├── __init__.py
│   ├── app.py
│   ├── config_manager.py
│   ├── hand_tracking/
│   │   ├── __init__.py
│   │   └── detector.py
│   ├── note_mapping/
│   │   ├── __init__.py
│   │   ├── zone.py
│   │   ├── layout_generator.py
│   │   └── interaction_logic.py
│   ├── expression_control/
│   │   ├── __init__.py
│   │   ├── pitch_bend_processor.py
│   │   └── velocity_intensity_processor.py
│   ├── audio_output/
│   │   ├── __init__.py
│   │   ├── midi_handler.py
│   │   ├── synth_handler.py
│   │   └── audio_engine.py
│   ├── ui/
│   │   ├── __init__.py
│   │   └── renderer.py
│   └── utils/
│       ├── __init__.py
│       ├── datatypes.py
│       └── math_utils.py
├── tests/
│   ├── __init__.py
│   └── (test_module.py files for various components)
├── main.py
├── README.md
└── requirements.txt
```

---

## List of Files and Descriptions

Here's a breakdown of the files and their intended roles:

### Root Directory: `hand_tracked_musical_interface/`

* **`README.md`**
    * **Description:** General information about the project. Includes an overview, setup instructions (dependencies, how to run), basic usage guide, and potentially contribution guidelines or known issues.
* **`requirements.txt`**
    * **Description:** A text file listing all Python package dependencies (e.g., `mediapipe`, `opencv-python`, `mido`, `python-rtmidi`, `PyYAML`) required to run the project. Used for easy environment setup (`pip install -r requirements.txt`).
* **`main.py`**
    * **Description:** The main executable script that serves as the entry point for the application. It will initialize and run the main application object from `src/app.py`.

### Configuration Directory: `config/`

* **`config.yaml`** (or `config.json`)
    * **Description:** The primary configuration file for the application, as detailed in Section 6 of the specification. Stores settings for display, audio, MIDI, layout, visual feedback, etc.

### Documentation Directory: `docs/`

* **`specification.md`**
    * **Description:** This evolving specification document that we are currently creating.

### Resources Directory: `resources/` (Optional)

* This directory would hold any external resources needed by the application.
    * **`samples/`**: (Optional) If direct audio synthesis uses samples, this subdirectory would contain the audio files (e.g., `.wav`, `.mp3`).
    * **`fonts/`**: (Optional) If custom fonts are used for the UI, they would be stored here.

### Source Code Directory: `src/`

This directory contains the core Python code for the application, organized into modules.

* **`__init__.py`**
    * **Description:** Makes the `src` directory a Python package.
* **`app.py`**
    * **Description:** Contains the main `Application` class. This class will be responsible for initializing all components (hand tracking, UI, audio engine, configuration), managing the main application loop, and coordinating interactions between different modules.
* **`config_manager.py`**
    * **Description:**
        * Contains a `ConfigManager` class.
        * **Usage:** Loads, validates, and provides access to the application settings from `config/config.yaml`. It will offer an interface for other modules to query configuration values.
* **`hand_tracking/` (Sub-package)**
    * `__init__.py`: Makes `hand_tracking` a Python sub-package.
    * `detector.py`:
        * **Description:** Contains the `HandDetector` class.
        * **Usage:** Interfaces with the `mediapipe` library to process camera frames, detect hand landmarks, and determine finger states (e.g., extended, retracted). Outputs structured data about hand positions and finger gestures.
* **`note_mapping/` (Sub-package)**
    * `__init__.py`: Makes `note_mapping` a Python sub-package.
    * `zone.py`:
        * **Description:** Contains the `NoteZone` class.
        * **Usage:** Represents a single interactive musical note zone on the screen. Stores properties like its boundaries, assigned musical note, label, and current state (e.g., active, finger ID, highlight status).
    * `layout_generator.py`:
        * **Description:** Contains the `LayoutGenerator` class.
        * **Usage:** Responsible for creating and managing the collection of `NoteZone` objects. Generates layouts based on configuration settings such as `starting_note`, `num_octaves`, `active_scale`, and `preset_scales` (handling both chromatic and scale-specific layouts).
    * `interaction_logic.py`:
        * **Description:** Contains the `InteractionManager` class.
        * **Usage:** Core logic for musical interaction. Processes output from `HandDetector` against the note zones generated by `LayoutGenerator`. Implements the rules for note triggering (finger entering/leaving zone), sustaining notes, and handling single note instances per zone as per Section 1 of the specification. It will also manage MPE channel assignments per active finger/note.
* **`expression_control/` (Sub-package)**
    * `__init__.py`: Makes `expression_control` a Python sub-package.
    * `pitch_bend_processor.py`:
        * **Description:** Contains the `PitchBendProcessor` class.
        * **Usage:** Calculates pitch bend values based on the horizontal (X-axis) position of a finger within an active `NoteZone`, according to Section 3.1.
    * `velocity_intensity_processor.py`:
        * **Description:** Contains the `VelocityIntensityProcessor` class.
        * **Usage:** Determines initial note velocity from the vertical (Y-axis) position of the finger upon entering a zone, and subsequently processes continuous Y-axis movement for intensity/expression modulation, as per Section 3.2.
* **`audio_output/` (Sub-package)**
    * `__init__.py`: Makes `audio_output` a Python sub-package.
    * `midi_handler.py`:
        * **Description:** Contains the `MidiHandler` class.
        * **Usage:** Manages all MIDI output using libraries like `mido` and `python-rtmidi`. Sends `Note On`, `Note Off`, `Pitch Bend`, and continuous expressive messages (e.g., Channel Pressure or CCs). Handles MPE channel allocation and routing.
    * `synth_handler.py`:
        * **Description:** (Optional, for direct audio synthesis) Contains a `SynthHandler` base class or concrete implementation.
        * **Usage:** Provides an interface to an internal sound synthesis engine (e.g., using `pyo`, `pygame.mixer`, or basic waveform generation). Plays notes with specified pitch, initial intensity, and continuous intensity modulation.
    * `audio_engine.py`:
        * **Description:** Contains the `AudioEngine` class.
        * **Usage:** Acts as a facade or router for audio output. Based on the `audio_mode` configuration, it directs note events (play, stop, modulate) to the `MidiHandler`, `SynthHandler`, or both.
* **`ui/` (Sub-package)**
    * `__init__.py`: Makes `ui` a Python sub-package.
    * `renderer.py`:
        * **Description:** Contains the `Renderer` class (or `DisplayManager`).
        * **Usage:** Responsible for all visual output. Uses `cv2` (or an alternative like `pygame` or `PyQt` if the UI becomes more complex) to draw the camera feed, overlay note zones (with labels and highlights), display hand landmarks, and provide visual feedback for expressive controls (e.g., pitch bend indicators, velocity/intensity visualizations).
* **`utils/` (Sub-package)**
    * `__init__.py`: Makes `utils` a Python sub-package.
    * `datatypes.py`:
        * **Description:** (Optional, or combined into relevant modules) Defines common custom data structures, enums (e.g., `Point`, `Color`, `NoteData`, `FingerState`), or named tuples used across multiple modules to ensure consistency.
    * `math_utils.py`:
        * **Description:** Contains utility functions for common mathematical operations.
        * **Usage:** Provides helper functions for tasks like linear mapping (e.g., for pitch bend, velocity), coordinate transformations, distance calculations, etc.

### Tests Directory: `tests/`

* **`__init__.py`**
    * **Description:** Makes the `tests` directory a Python package.
* **`test_*.py` files** (e.g., `test_config_manager.py`, `test_layout_generator.py`)
    * **Description:** Contains unit tests and integration tests for the various components and classes in the `src/` directory. This ensures code correctness and helps prevent regressions. (e.g., using `unittest` or `pytest`).
